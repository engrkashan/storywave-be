generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  CREATOR
}

enum CreationType {
  STORY
  VIDEO
  IMAGE
  VOICEOVER
  PODCAST
}

enum Platform {
  INSTAGRAM
  YOUTUBE
  TIKTOK
  SPOTIFY
  LINKEDIN
  X
  FACEBOOK
}

enum MediaType {
  SCRIPT
  AUDIO
  IMAGE
  VIDEO
  SUBTITLE
  PODCAST
  TRANSCRIPT
}

enum InputType {
  URL
  TEXT
  VIDEO
}

model User {
  id         String  @id @default(auto()) @map("_id") @db.ObjectId
  fullName   String?
  email      String  @unique
  username   String  @unique
  password   String
  profileURL String?
  role       Role    @default(ADMIN)

  creations    Creation[]
  integrations Integration[]
  workflows    Workflow[]

  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  lastLoginAt DateTime?
  stories     Story[]
  videos      Video[]
  voiceovers  Voiceover[]
  podcasts    Podcast[]
}

model Input {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  type      InputType
  source    String
  processed Boolean   @default(false)

  workflow   Workflow @relation(fields: [workflowId], references: [id])
  workflowId String   @db.ObjectId

  createdAt DateTime @default(now())
}

model Task {
  id       String  @id @default(auto()) @map("_id") @db.ObjectId
  step     String
  status   String  @default("QUEUED")
  log      String?
  metadata Json?

  workflow   Workflow @relation(fields: [workflowId], references: [id])
  workflowId String   @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Story {
  id      String  @id @default(auto()) @map("_id") @db.ObjectId
  title   String
  outline String?
  content String

  user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId

  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  Workflow  Workflow[]
}

model Video {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  title     String
  fileURL   String?
  duration  Int?
  subtitles String?

  user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId

  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  Workflow  Workflow[]
}

model Voiceover {
  id       String  @id @default(auto()) @map("_id") @db.ObjectId
  script   String
  audioURL String?
  voice    String?
  userId   String?

  workflow   Workflow @relation(fields: [workflowId], references: [id])
  workflowId String   @unique @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User?    @relation(fields: [userId], references: [id])
}

enum WorkflowStatus {
  PENDING
  SCHEDULED
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

model Workflow {
  id          String         @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  type        CreationType
  subType     String?
  status      WorkflowStatus @default(PENDING)
  scheduledAt DateTime?
  metadata    Json?

  user   User?   @relation(fields: [userId], references: [id])
  userId String? @db.ObjectId

  inputs    Input[]
  story     Story?     @relation(fields: [storyId], references: [id])
  voiceover Voiceover?
  video     Video?     @relation(fields: [videoId], references: [id])
  podcast   Podcast?
  media     Media[]
  tasks     Task[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  storyId   String?  @db.ObjectId
  videoId   String?  @db.ObjectId
}

model Podcast {
  id       String  @id @default(auto()) @map("_id") @db.ObjectId
  title    String
  audience String?
  subType  String?

  user   User?   @relation(fields: [userId], references: [id])
  userId String? @db.ObjectId

  workflow   Workflow  @relation(fields: [workflowId], references: [id])
  workflowId String    @unique @db.ObjectId
  episodes   Episode[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Episode {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  title     String
  script    String
  audioURL  String
  duration  Int?
  episodeNo Int
  podcast   Podcast  @relation(fields: [podcastId], references: [id])
  podcastId String   @db.ObjectId
  createdAt DateTime @default(now())
}

model Creation {
  id       String       @id @default(auto()) @map("_id") @db.ObjectId
  type     CreationType
  title    String?
  content  String?
  mediaURL String?
  metadata Json?

  user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Integration {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  platform    Platform
  accountId   String
  accessToken String

  user   User   @relation(fields: [userId], references: [id])
  userId String @db.ObjectId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Media {
  id       String    @id @default(auto()) @map("_id") @db.ObjectId
  type     MediaType
  fileUrl  String
  fileType String
  publicId String?
  metadata Json?

  workflow   Workflow? @relation(fields: [workflowId], references: [id])
  workflowId String?   @db.ObjectId

  uploadedAt DateTime @default(now())
}
